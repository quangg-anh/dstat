<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Layer7 Stats - LotusCount</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html, body {
      height: 100%;
      font-family: 'Segoe UI', sans-serif;
      background-color: #121212;
      color: #fff;
    }

    .container {
      padding: 40px 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 40px;
    }

    .stats {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 20px;
      width: 100%;
      max-width: 1200px;
    }

    .card {
      flex: 1 1 280px;
      background-color: #1e1e1e;
      padding: 24px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      position: relative;
    }

    .card i {
      font-size: 40px;
      margin-bottom: 16px;
      color: #f06292;
    }

    .card h3 {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 8px;
      color: #ccc;
    }

    .card p {
      font-size: 28px;
      font-weight: bold;
      color: #fff;
    }

    .chart-container {
      width: 100%;
      max-width: 1200px;
      background-color: #1e1e1e;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    #chart {
      width: 100%;
      height: 500px;
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="stats">
      <div class="card">
        <i class="fas fa-chart-area"></i>
        <h3>Average Requests</h3>
        <p id="avg-data">Loading...</p>
      </div>
      <div class="card">
        <i class="fas fa-chart-line"></i>
        <h3>Peak Requests</h3>
        <p id="peak-data">Loading...</p>
      </div>
      <div class="card">
        <i class="fa-solid fa-dice-d20"></i>
        <h3>Overall Requests</h3>
        <p id="total-data">Loading...</p>
      </div>
    </div>

    <div class="chart-container">
      <div id="chart"></div>
    </div>
  </div>

  <script src="https://code.highcharts.com/highcharts.js"></script>
  <script src="https://code.highcharts.com/modules/exporting.js"></script>
  <script>
    window.onload = () => {
      const queryParams = new URLSearchParams(window.location.search);
      const dataString = queryParams.get('data');
      const data = dataString ? JSON.parse(dataString) : [];

      const total = data.reduce((acc, val) => acc + val, 0);
      const peak = Math.max(...data);
      const avg = total / data.length || 0;

      const format = (num) => {
        return num >= 1000 ? (num / 1000).toFixed(2).replace(/\.00$/, '') + 'k' : num;
      };

      document.getElementById('avg-data').textContent = format(Math.round(avg));
      document.getElementById('peak-data').textContent = format(peak);
      document.getElementById('total-data').textContent = format(total);

      Highcharts.chart('chart', {
        chart: {
          type: 'area',
          backgroundColor: '#1e1e1e',
          animation: false,
          events: {
            load() {
              this.renderer.text('@lotuscount', 260, 440)
                .attr({ rotation: -38 })
                .css({ fontSize: '48px', opacity: 0.15, color: '#fff' })
                .add();
            }
          }
        },
        title: {
          text: 'LotusCount L7 Activity Graph',
          style: { color: '#fff' }
        },
        xAxis: {
          labels: { style: { color: '#aaa' } },
          gridLineColor: '#444'
        },
        yAxis: {
          title: null,
          labels: { style: { color: '#aaa' } },
          gridLineColor: '#444'
        },
        legend: {
          itemStyle: { color: '#fff' }
        },
        series: [{
          name: 'Requests/sec',
          data: data,
          color: '#e91e63',
          lineColor: '#f06292',
          fillOpacity: 0.3,
          animation: false
        }],
        credits: { enabled: false },
        exporting: { enabled: false }
      });
    };
  </script>
</body>
</html>
